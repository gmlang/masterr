<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>Analyze Stock Price Data Using R, Part2 &#8211; Become Great at R</title>
<meta name="description" content="When constructing a portfolio, it’s important to pick un-correlated assets. This is just a corollary of the “don’t put all your eggs in one basket” principle. If asset B goes up (or down) when asset A goes up (or down) and vice versa, there’s really no reason to own both assets. By and large, assets of different classes are weakly correlated, for example, stocks and bonds, stocks and gold, and etc. In part1, I said I’m interested in a vanguard energy fund (VGENX) because oil price has been hammered. However, because I already own the Total Stock Market Index Fund (VTSMX), I want to find out how correlated VGENX is with VTSMX.

">
<meta name="keywords" content="">



<!-- Twitter Cards -->
<meta name="twitter:title" content="Analyze Stock Price Data Using R, Part2">
<meta name="twitter:description" content="When constructing a portfolio, it’s important to pick un-correlated assets. This is just a corollary of the “don’t put all your eggs in one basket” principle. If asset B goes up (or down) when asset A goes up (or down) and vice versa, there’s really no reason to own both assets. By and large, assets of different classes are weakly correlated, for example, stocks and bonds, stocks and gold, and etc. In part1, I said I’m interested in a vanguard energy fund (VGENX) because oil price has been hammered. However, because I already own the Total Stock Market Index Fund (VTSMX), I want to find out how correlated VGENX is with VTSMX.

">
<meta name="twitter:site" content="@gmlang">
<meta name="twitter:creator" content="@gmlang">

<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://gmlang.com/images/site-logo.png">

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Analyze Stock Price Data Using R, Part2">
<meta property="og:description" content="When constructing a portfolio, it’s important to pick un-correlated assets. This is just a corollary of the “don’t put all your eggs in one basket” principle. If asset B goes up (or down) when asset A goes up (or down) and vice versa, there’s really no reason to own both assets. By and large, assets of different classes are weakly correlated, for example, stocks and bonds, stocks and gold, and etc. In part1, I said I’m interested in a vanguard energy fund (VGENX) because oil price has been hammered. However, because I already own the Total Stock Market Index Fund (VTSMX), I want to find out how correlated VGENX is with VTSMX.

">
<meta property="og:url" content="http://gmlang.com/r/analyze-stock-price-data-using-r-part2/">
<meta property="og:site_name" content="Become Great at R">





<link rel="canonical" href="http://gmlang.com/r/analyze-stock-price-data-using-r-part2/">
<link href="http://gmlang.com/feed.xml" type="application/atom+xml" rel="alternate" title="Become Great at R Feed">
<link rel="author" href="http://plus.google.com/+GuangmingLang?rel=author">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<link rel="stylesheet" href="http://gmlang.com/assets/css/main.css">
<!-- Webfonts -->
<script src="//use.edgefonts.net/source-sans-pro:n2,i2,n3,i3,n4,i4,n6,i6,n7,i7,n9,i9;source-code-pro:n4,n7;volkhov.js"></script>

<meta http-equiv="cleartype" content="on">

<!-- HTML5 Shiv and Media Query Support -->
<!--[if lt IE 9]>
  <script src="http://gmlang.com/assets/js/vendor/html5shiv.min.js"></script>
  <script src="http://gmlang.com/assets/js/vendor/respond.min.js"></script>
<![endif]-->

<!-- Modernizr -->
<script src="http://gmlang.com/assets/js/vendor/modernizr-2.7.1.custom.min.js"></script>

<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="http://gmlang.com/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="http://gmlang.com/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="http://gmlang.com/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="http://gmlang.com/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="http://gmlang.com/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://gmlang.com/images/apple-touch-icon-144x144-precomposed.png">

</head>

<body id="post">

<div class="navigation-wrapper">
	<nav role="navigation" id="site-nav" class="animated drop">
	    <ul>
      
		    
		        
		    
		    <li><a href="http://gmlang.com/about/" >About</a></li>
		  
		    
		        
		    
		    <li><a href="http://gmlang.com/da/" >Data Analysis</a></li>
		  
		    
		        
		    
		    <li><a href="http://gmlang.com/r/" >R</a></li>
		  
		    
		        
		    
		    <li><a href="http://gmlang.com/cartoon/" >Cartoon</a></li>
		  
        <li class="dosearch"><span><i class="fa fa-search"></i> Search</span></li>
	    </ul>
	</nav>
</div><!-- /.navigation-wrapper -->

<!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->

<div class="search-wrapper">
  <div class="search-form">
    <input type="text" class="search-field" placeholder="Search...">
    <button class="close-btn"><i class="fa fa-times-circle fa-2x"></i></button>
    <ul class="search-results post-list"></ul><!-- /.search-results -->
  </div><!-- /.search-form -->
</div><!-- ./search-wrapper -->

<header class="masthead">
	<div class="wrap">
        
    		<a href="http://gmlang.com" class="site-logo" rel="home" title="Become Great at R"><img src="http://gmlang.com/images/site-logo.png" width="200" height="200" alt="Become Great at R logo" class="animated fadeInUp"></a>
        
        <h1 class="site-title animated fadeIn"><a href="http://gmlang.com">Become Great at R</a></h1>
		<h2 class="site-description animated fadeIn" itemprop="description"></h2>
	</div>
</header><!-- /.masthead -->

<div class="js-menu-screen menu-screen"></div>

<div id="main" role="main">
  <article class="hentry">
    
    <div class="entry-wrapper">
      <header class="entry-header">
        <span class="entry-tags"></span>
        
          <h1 class="entry-title">Analyze Stock Price Data Using R, Part2</h1>
        
      </header>
      <footer class="entry-meta">
        
        
        
          <img src="http://gmlang.com/images/gmlang1.jpg" class="bio-photo" alt="Guangming Lang bio photo"></a>
        
        <span class="author vcard">By <span class="fn">Guangming Lang</span></span>
        <span class="entry-date date published"><time datetime="2014-10-19T12:48:49-04:00"><i class="fa fa-calendar-o"></i> October 19, 2014</time></span>
        
        <span class="entry-comments"><i class="fa fa-comment-o"></i> <a href="#disqus_thread">Comment</a></span>
        <span class="social-share-twitter">
  <a href="https://twitter.com/intent/tweet?hashtags=&amp;text=Analyze%20Stock%20Price%20Data%20Using%20R,%20Part2&amp;url=http://gmlang.com/r/analyze-stock-price-data-using-r-part2/&amp;via=gmlang" title="Share on Twitter" itemprop="Twitter"><i class="fa fa-twitter-square"></i> Tweet</a>
</span>
<span class="social-share-facebook">
  <a href="https://www.facebook.com/sharer/sharer.php?u=http://gmlang.com/r/analyze-stock-price-data-using-r-part2/" title="Share on Facebook" itemprop="Facebook"><i class="fa fa-facebook-square"></i> Like</a>
</span>
<span class="social-share-googleplus">
  <a href="https://plus.google.com/share?url=http://gmlang.com/r/analyze-stock-price-data-using-r-part2/" title="Share on Google Plus" itemprop="GooglePlus"><i class="fa fa-google-plus-square"></i> +1</a>
</span>
<!-- /.social-share -->
        
      </footer>
      <div class="entry-content">
        <p>When constructing a portfolio, it’s important to pick un-correlated assets. This is just a corollary of the “don’t put all your eggs in one basket” principle. If asset B goes up (or down) when asset A goes up (or down) and vice versa, there’s really no reason to own both assets. By and large, assets of different classes are weakly correlated, for example, stocks and bonds, stocks and gold, and etc. In <a href="http://gmlang.com/r/analyze-stock-price-data-using-r-part1/">part1</a>, I said I’m interested in a vanguard energy fund (VGENX) because oil price has been hammered. However, because I already own the Total Stock Market Index Fund (VTSMX), I want to find out how correlated VGENX is with VTSMX.</p>

<h3 id="load-libraries-and-helper-functions">1. Load libraries and helper functions</h3>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="kn">library</span><span class="p">(</span>PerformanceAnalytics<span class="p">)</span>
<span class="kn">library</span><span class="p">(</span>zoo<span class="p">)</span>
<span class="kn">library</span><span class="p">(</span>tseries<span class="p">)</span></code></pre></div>

<h3 id="download-the-monthly-adjusted-closing-price-data-on-vgenx-and-vtsmx-since-sept-2005-from-yahoo">2. Download the monthly adjusted closing price data on VGENX and VTSMX since Sept 2005 from Yahoo!.</h3>

<div class="highlight"><pre><code class="language-r" data-lang="r">VGENX <span class="o">=</span> get.hist.quote<span class="p">(</span>instrument<span class="o">=</span><span class="s">&quot;VGENX&quot;</span><span class="p">,</span> start<span class="o">=</span><span class="s">&quot;2005-09-30&quot;</span><span class="p">,</span> 
                       end<span class="o">=</span><span class="s">&quot;2014-09-30&quot;</span><span class="p">,</span> origin<span class="o">=</span><span class="s">&quot;1970-01-01&quot;</span><span class="p">,</span>
                       quote<span class="o">=</span><span class="s">&quot;AdjClose&quot;</span><span class="p">,</span> provider<span class="o">=</span><span class="s">&quot;yahoo&quot;</span><span class="p">,</span> 
                       compression<span class="o">=</span><span class="s">&quot;m&quot;</span><span class="p">,</span> retclass<span class="o">=</span><span class="s">&quot;zoo&quot;</span><span class="p">)</span></code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">## time series ends   2014-09-02</code></pre></div>

<div class="highlight"><pre><code class="language-r" data-lang="r">VTSMX <span class="o">=</span> get.hist.quote<span class="p">(</span>instrument<span class="o">=</span><span class="s">&quot;VTSMX&quot;</span><span class="p">,</span> start<span class="o">=</span><span class="s">&quot;2005-09-30&quot;</span><span class="p">,</span> 
                       end<span class="o">=</span><span class="s">&quot;2014-09-30&quot;</span><span class="p">,</span> origin<span class="o">=</span><span class="s">&quot;1970-01-01&quot;</span><span class="p">,</span>
                       quote<span class="o">=</span><span class="s">&quot;AdjClose&quot;</span><span class="p">,</span> provider<span class="o">=</span><span class="s">&quot;yahoo&quot;</span><span class="p">,</span>
                       compression<span class="o">=</span><span class="s">&quot;m&quot;</span><span class="p">,</span> retclass<span class="o">=</span><span class="s">&quot;zoo&quot;</span><span class="p">)</span></code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">## time series ends   2014-09-02</code></pre></div>

<h3 id="change-the-class-of-the-time-index-to-yearmon">3. Change the class of the time index to yearmon.</h3>

<div class="highlight"><pre><code class="language-r" data-lang="r">index<span class="p">(</span>VGENX<span class="p">)</span> <span class="o">=</span> as.yearmon<span class="p">(</span>index<span class="p">(</span>VGENX<span class="p">))</span>
index<span class="p">(</span>VTSMX<span class="p">)</span> <span class="o">=</span> as.yearmon<span class="p">(</span>index<span class="p">(</span>VTSMX<span class="p">))</span></code></pre></div>

<h3 id="merge-both-price-series-into-one-data-frame-and-calculate-continuously-compounded-returns">4. Merge both price series into one data frame and Calculate continuously compounded returns.</h3>

<div class="highlight"><pre><code class="language-r" data-lang="r">prices <span class="o">=</span> <span class="kp">merge</span><span class="p">(</span>VGENX<span class="p">,</span> VTSMX<span class="p">)</span>
<span class="kp">colnames</span><span class="p">(</span>prices<span class="p">)</span> <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="s">&quot;VGENX&quot;</span><span class="p">,</span> <span class="s">&quot;VTSMX&quot;</span><span class="p">)</span>
ret.cc <span class="o">=</span> <span class="kp">diff</span><span class="p">(</span><span class="kp">log</span><span class="p">(</span>prices<span class="p">))</span>
<span class="kp">head</span><span class="p">(</span>ret.cc<span class="p">,</span> <span class="m">3</span><span class="p">)</span></code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">##                VGENX        VTSMX
## Oct 2005 -0.08831978 -0.018616483
## Nov 2005  0.02154139  0.038859285
## Dec 2005  0.03159695  0.001570475</code></pre></div>

<h3 id="plot-cumulative-returns">5. Plot cumulative returns.</h3>

<div class="highlight"><pre><code class="language-r" data-lang="r">ret.simple <span class="o">=</span> <span class="kp">diff</span><span class="p">(</span>prices<span class="p">)</span> <span class="o">/</span> lag<span class="p">(</span>prices<span class="p">,</span> k<span class="o">=</span><span class="m">-1</span><span class="p">)</span>
chart.CumReturns<span class="p">(</span>ret.simple<span class="p">,</span> legend.loc<span class="o">=</span><span class="s">&quot;topleft&quot;</span><span class="p">,</span> wealth.index<span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span> 
                 ylab<span class="o">=</span><span class="s">&quot;$&quot;</span><span class="p">,</span> main<span class="o">=</span><span class="s">&quot;Future Value of $1 invested&quot;</span><span class="p">)</span></code></pre></div>

<p><img src="/../figs/2014-10-19-analyze-stock-price-data-using-r-part2/unnamed-chunk-5-1.png" alt="center" /> </p>

<h3 id="display-pair-wise-scatter-plots">6. Display pair-wise scatter plots</h3>

<div class="highlight"><pre><code class="language-r" data-lang="r">return_matrix <span class="o">=</span> coredata<span class="p">(</span>ret.cc<span class="p">)</span>
pairs<span class="p">(</span>return_matrix<span class="p">,</span> pch<span class="o">=</span><span class="m">16</span><span class="p">,</span> col<span class="o">=</span><span class="s">&quot;dodgerblue2&quot;</span><span class="p">)</span></code></pre></div>

<p><img src="/../figs/2014-10-19-analyze-stock-price-data-using-r-part2/unnamed-chunk-6-1.png" alt="center" /> </p>

<p>Both plots show the returns of VGENX and VTSMX are pretty correlated.</p>

<h3 id="compute-correlation-matrices">7. Compute correlation matrices</h3>

<div class="highlight"><pre><code class="language-r" data-lang="r">cor<span class="p">(</span>return_matrix<span class="p">)</span></code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">##           VGENX     VTSMX
## VGENX 1.0000000 0.7835808
## VTSMX 0.7835808 1.0000000</code></pre></div>

<p>We see their correlation is 0.78, which is pretty high.</p>

        <div id="disqus_thread"></div><!-- /#disqus_thread -->
      </div><!-- /.entry-content -->
    </div><!-- /.entry-wrapper -->
    <nav class="pagination" role="navigation">
      
        <a href="http://gmlang.com/r/analyze-stock-price-data-using-r-part1/" class="btn" title="Analyze Stock Price Data Using R, Part1">Previous</a>
      
      
        <a href="http://gmlang.com/da/bias-and-precision/" class="btn" title="Bias and Precision">Next</a>
      
    </nav><!-- /.pagination -->
  </article>
</div><!-- /#main -->

<div class="footer-wrapper">
  <footer role="contentinfo" class="entry-wrapper">
    

<span>&copy; 2014 Guangming Lang. Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> using the <a href="http://mademistakes.com/so-simple/" rel="nofollow">So Simple Theme</a>.</span>
<div class="social-icons">
	<a href="http://twitter.com/gmlang" title="Guangming Lang on Twitter" target="_blank"><i class="fa fa-twitter-square fa-2x"></i></a>
	
	<a href="http://plus.google.com/+GuangmingLang" title="Guangming Lang on Google+" target="_blank"><i class="fa fa-google-plus-square fa-2x"></i></a>
	<a href="http://linkedin.com/in/gmlang" title="Guangming Lang on LinkedIn" target="_blank"><i class="fa fa-linkedin-square fa-2x"></i></a>
	
	
	
	<a href="http://github.com/gmlang" title="Guangming Lang on Github" target="_blank"><i class="fa fa-github-square fa-2x"></i></a>
	
  <a href="http://gmlang.com/feed.xml" title="Atom/RSS feed"><i class="fa fa-rss-square fa-2x"></i></a>
</div><!-- /.social-icons -->
  </footer>
</div><!-- /.footer-wrapper -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="http://gmlang.com/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="http://gmlang.com/assets/js/scripts.min.js"></script>

<!-- Jekyll Simple Search option -->
<script>
  $(document).ready(function() {
      $('.search-field').jekyllSearch({
          jsonFile: 'http://gmlang.com/search.json',
          searchResults: '.search-results',
          template: '<li><article><a href="{url}">{title} <span class="entry-date"><time datetime="{date}">{shortdate}</time></span></a></article></li>',
          fuzzy: true,
          noResults: '<p>Nothing found.</p>'
        });
  });

  (function( $, window, undefined ) {
    
     var bs = {
          close: $(".close-btn"),
          searchform: $(".search-form"),
          canvas: $(".js-menu-screen"),
          dothis: $('.dosearch')
      };
    
    bs.dothis.on('click', function() {
      $('.search-wrapper').css({ display: "block" });
      $('body').toggleClass('no-scroll');
      bs.searchform.toggleClass('active');
      bs.searchform.find('input').focus();
      bs.canvas.toggleClass('is-visible');
    });
    
      bs.close.on('click', function() {
        $('.search-wrapper').removeAttr( 'style' );
        $('body').toggleClass('no-scroll');
        bs.searchform.toggleClass('active');
        bs.canvas.removeClass('is-visible');
    });
  })( jQuery, window );
</script>


<!-- Asynchronous Google Analytics snippet -->
<script>
  var _gaq = _gaq || [];
  var pluginUrl = 
 '//www.google-analytics.com/plugins/ga/inpage_linkid.js';
  _gaq.push(['_require', 'inpage_linkid', pluginUrl]);
  _gaq.push(['_setAccount', 'UA-52975110-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'stats.g.doubleclick.net/dc.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>



  
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'cabaceo'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>



<!-- Mathjax -->
<script type="text/javascript"
    src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>	        

</body>
</html>
