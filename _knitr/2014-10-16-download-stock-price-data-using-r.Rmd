---
layout: post
title: "Download Stock Price Data Using R"
date: 2014-10-16 13:48:49 -0400
comments: true
categories: r
keywords: "R, PerformanceAnalytics, zoo, tseries, download stock price data using R, analyze stock price data using R"
published: true
share: true

---

Downloading and charting stock prices data become easy when using the `tseries` and `PerformanceAnalytics` R packages. 

Step 1. Load these libraries.
```{r, warning=FALSE, message=FALSE}
library(PerformanceAnalytics)
library(zoo)
library(tseries)
```

Step 2. Download the monthly adjusted closing price data on S&P500 (^GSPC) and NovaGold (NG) between Jan 2004 and Sept 2014 from Yahoo using the function `get.hist.quote()` from the `tseries` package.
```{r}
sp500 = get.hist.quote(instrument="^GSPC", start="2004-01-01", 
                       end="2014-09-30", origin="1970-01-01",
                       quote="AdjClose", provider="yahoo", 
                       compression="m", retclass="zoo")
ng = get.hist.quote(instrument="NG", start="2004-01-01", 
                    end="2014-09-30", origin="1970-01-01",
                    quote="AdjClose", provider="yahoo", 
                    compression="m", retclass="zoo")
```

Step 3. Change the class of the time index to yearmon which is appropriate for monthly data using `as.yearmon()` in the `zoo` package.  
```{r}
index(sp500) = as.yearmon(index(sp500))
index(ng) = as.yearmon(index(ng))

# inspect the price data
cat("Start: ", as.character(start(sp500)), "  End: ", as.character(end(sp500)))
cat("Start: ", as.character(start(ng)), "  End: ", as.character(end(ng)))
```

Step 4. Put both SP500 and NG price data in one data frame to make it easier for analysis.
```{r}
prices = merge(sp500, ng)
colnames(prices) = c("SP500", "NG")
```

Step 5. Calculate continuously compounded returns as difference in log prices.
```{r}
ret.cc = diff(log(prices))

# inspect the return data
cat("Start: ", as.character(start(ret.cc)), "  End: ", as.character(end(ret.cc)))
head(ret.cc, 3)
```

Step 6. Plot returns using `chart.TimeSeries()` and `chart.Bar()` in the `PerformanceAnalytics` package. 
```{r}
chart.TimeSeries(ret.cc, legend.loc="bottomright", main="", 
                 ylab="monthly cc return") 
chart.Bar(ret.cc, legend.loc="bottomright", main="", 
          ylab="monthly cc return")
```

Step 7. Plot cumulative returns using `chart.CumReturns()` in the `PerformanceAnalytics` package. 
Note we need to use simple returns instead of continuously compounded returns for this, so we first calcualte the simple returns using `diff()` and `lag()` on the price data.
```{r}
ret.simple = diff(prices) / lag(prices, k=-1)
chart.CumReturns(ret.simple, legend.loc="topleft", wealth.index=TRUE, 
                 ylab="$", main="Future Value of $1 invested")
```

